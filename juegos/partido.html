<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>El Corredor</title>
    <style>
      #body-partido {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f2f2f2;
        margin: 0;
        padding: 20px;
      }
      .titulo-partido {
        font-size: 7em;
        margin-bottom: 20px;
        margin-top: 10px;
      }
      .juego {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        gap: 30px;
      }
      .zona-izquierda {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .escenario {
        position: relative;
        width: 500px;
        height: 300px;
        border: 4px solid #333;
        background: linear-gradient(#3ba63b, #2d7a2d);
        border-radius: 10px;
        overflow: hidden;
      }
      .muneco {
        position: absolute;
        bottom: 80px;
        left: 0;
        width: 50px;
        height: 50px;
        z-index: 2;
      }
      .muneco img {
        width: 100%;
        height: 100%;
        display: block;
      }
      .puerta {
        position: absolute;
        bottom: 0;
        right: 20px;
        width: 280px;
        height: 340px;
        z-index: 1;
      }
      .puerta img {
        width: 100%;
        height: 100%;
        display: block;
      }
      .palabra {
        font-size: 2em;
        letter-spacing: 10px;
        margin-top: 20px;
      }
      .letras {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(9, 1fr);
        gap: 8px;
      }
      .letras button {
        width: 50px;
        height: 50px;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
        border-radius: 6px;
        border: none;
        background: #ddd;
        transition: all 0.2s;
      }
      .letras button:disabled {
        cursor: not-allowed;
        color: #fff;
      }
      .fondo-palabras {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: -1;
      }

      /* -------- MODALES -------- */
      #modal-partido,
      #modal-final {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
      }
      #modal-contenido,
      #modal-final-contenido {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        width: 300px;
      }
      #modal-contenido input,
      #modal-contenido select {
        padding: 8px;
        font-size: 1em;
        margin: 10px 0;
        width: 90%;
      }
      #modal-contenido button,
      #modal-final-contenido button {
        padding: 10px 20px;
        font-size: 1em;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        background: #28a745;
        color: white;
        margin: 5px;
      }

      /* -------- MARCADOR -------- */
      #marcador {
        position: absolute;
        top: 20px;
        right: 30px;
        background: #333;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 1.8em;
        font-weight: bold;
      }
    </style>
  </head>
  <body id="body-partido">
    <img
      src="../assets/img/imagenes/pizarra.jpg"
      class="fondo-palabras"
      alt=""
    />
    <h1 class="titulo-partido">El Partido</h1>

    <!-- MARCADOR -->
    <div id="marcador">0</div>

    <!-- Modal inicial -->
    <div id="modal-partido">
      <div id="modal-contenido">
        <h2>Inicia tu juego</h2>
        <input type="text" id="usuario" placeholder="Nombre de usuario" />
        <select id="nivel">
          <option value="facil">Fácil (11 fallos)</option>
          <option value="medio">Medio (7 fallos)</option>
          <option value="dificil">Difícil (4 fallos)</option>
        </select>
        <br />
        <button onclick="iniciarJuego()">Empezar</button>
        <button
          onclick="location.href='../backend/paginaRankingPalabras.php'"
          style="background: #007bff"
        >
          Ver Ranking
        </button>
      </div>
    </div>

    <!-- Modal final -->
    <div id="modal-final" style="display: none">
      <div id="modal-final-contenido">
        <h2>Fin del juego</h2>
        <p id="resultado"></p>
        <button onclick="reiniciarCompleto()">Volver a jugar</button>
        <button onclick="location.reload()">Salir</button>
        <form
          method="POST"
          action="../backend/rankingPalabras.php"
          style="margin-top: 10px"
        >
          <input type="hidden" id="usuarioFinal" name="usuario" />
          <input type="hidden" id="puntosFinal" name="puntos" />
          <button type="submit">Registrar récord</button>
        </form>
      </div>
    </div>

    <div class="juego">
      <div class="zona-izquierda">
        <div class="escenario">
          <div class="muneco" id="muneco">
            <img src="../assets/img/iconos/pelota.png" alt="Pelota" />
          </div>
          <div class="puerta" id="puerta">
            <img src="../assets/img/iconos/porteria.png" alt="Portería" />
          </div>
        </div>
        <div class="palabra" id="palabra"></div>
      </div>
      <div class="letras" id="letras"></div>
    </div>

    <script src="../assets/js/palabras.js"></script>
    <script>
      let palabraSecreta;
      let progreso;
      let pasos = 0;
      let maxPasos;
      let usuario = "";
      let puntos = 0;

      const palabraEl = document.getElementById("palabra");
      const letrasEl = document.getElementById("letras");
      const muneco = document.getElementById("muneco");
      const puerta = document.getElementById("puerta");
      const marcador = document.getElementById("marcador");

      function iniciarJuego() {
        usuario = document.getElementById("usuario").value.trim();
        if (!usuario) {
          alert("Por favor ingresa un nombre de usuario");
          return;
        }

        const nivel = document.getElementById("nivel").value;
        if (nivel === "facil") maxPasos = 11;
        if (nivel === "medio") maxPasos = 7;
        if (nivel === "dificil") maxPasos = 4;

        document.getElementById("modal-partido").style.display = "none";

        puntos = 0;
        actualizarMarcador();
        nuevaPalabra();
      }

      function nuevaPalabra() {
        palabraSecreta =
          palabras[Math.floor(Math.random() * palabras.length)].toUpperCase();
        progreso = Array(palabraSecreta.length).fill("_");
        pasos = 0;
        muneco.style.left = "0px";
        letrasEl.innerHTML = "";
        mostrarPalabra();
        crearBotones();
      }

      function mostrarPalabra() {
        palabraEl.textContent = progreso.join(" ");
      }

      function crearBotones() {
        const abecedario = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ".split("");
        abecedario.forEach((letra) => {
          const btn = document.createElement("button");
          btn.textContent = letra;
          btn.onclick = () => manejarLetra(btn, letra);
          letrasEl.appendChild(btn);
        });
      }

      function manejarLetra(btn, letra) {
        btn.disabled = true;
        if (palabraSecreta.includes(letra)) {
          btn.style.background = "green";
          for (let i = 0; i < palabraSecreta.length; i++) {
            if (palabraSecreta[i] === letra) {
              progreso[i] = letra;
            }
          }
          mostrarPalabra();
          if (!progreso.includes("_")) {
            puntos++;
            actualizarMarcador();
            setTimeout(() => nuevaPalabra(), 500);
          }
        } else {
          btn.style.background = "red";
          pasos++;
          moverMuneco();
        }
      }

      function moverMuneco() {
        const escenario = document.querySelector(".escenario");
        const escenarioRect = escenario.getBoundingClientRect();
        const puertaRect = puerta.getBoundingClientRect();
        const centroPuerta =
          puertaRect.left - escenarioRect.left + puertaRect.width / 2;
        const destinoFinal = centroPuerta - muneco.clientWidth / 2;
        const paso = destinoFinal / maxPasos;
        muneco.style.left = pasos * paso + "px";

        if (pasos >= maxPasos) {
          setTimeout(() => mostrarFinal(), 300);
        }
      }

      function actualizarMarcador() {
        marcador.textContent = puntos;
      }

      function mostrarFinal() {
        document.getElementById("modal-final").style.display = "flex";
        document.getElementById("resultado").textContent =
          usuario + ", tu puntuación fue: " + puntos;
        document.getElementById("usuarioFinal").value = usuario;
        document.getElementById("puntosFinal").value = puntos;
      }

      function reiniciarCompleto() {
        document.getElementById("modal-final").style.display = "none";
        document.getElementById("modal-partido").style.display = "flex";
      }
    </script>
  </body>
</html>
