<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>El Corredor</title>
    <style>
      #body-partido {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f2f2f2;
        margin: 0;
        padding: 20px;
      }
      .titulo-partido {
        font-size: 7em;
        margin-bottom: 40px;
        margin-top: 10px;
      }
      .juego {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        gap: 30px;
      }
      .zona-izquierda {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .escenario {
        position: relative;
        width: 500px;
        height: 300px;
        border: 4px solid #333;
        background: linear-gradient(#3ba63b, #2d7a2d);
        border-radius: 10px;
        overflow: hidden;
      }
      .muneco {
        position: absolute;
        bottom: 80px;
        left: 0;
        width: 50px;
        height: 50px;
        z-index: 2;
      }
      .muneco img {
        width: 100%;
        height: 100%;
        display: block;
      }
      .puerta {
        position: absolute;
        bottom: 0;
        right: 20px;
        width: 280px;
        height: 340px;
        z-index: 1;
      }
      .puerta img {
        width: 100%;
        height: 100%;
        display: block;
      }
      .palabra {
        font-size: 2em;
        letter-spacing: 10px;
        margin-top: 20px;
      }
      .letras {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(9, 1fr);
        gap: 8px;
      }
      .letras button {
        width: 50px;
        height: 50px;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
        border-radius: 6px;
        border: none;
        background: #ddd;
        transition: all 0.2s;
      }
      .letras button:disabled {
        cursor: not-allowed;
        color: #fff;
      }

      .fondo-palabras {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: -1;
      }

      /* -------- Modal -------- */
      #modal-partido {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
      }
      #modal-contenido {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        width: 300px;
      }
      #modal-contenido h2 {
        margin-bottom: 20px;
      }
      #modal-contenido select {
        padding: 8px;
        font-size: 1em;
        margin-bottom: 20px;
      }
      #modal-contenido button {
        padding: 10px 20px;
        font-size: 1em;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        background: #28a745;
        color: white;
      }
    </style>
  </head>
  <body id="body-partido">
    <img
      src="../assets/img/imagenes/pizarra.jpg"
      class="fondo-palabras"
      alt=""
    />
    <h1 class="titulo-partido">El Corredor</h1>

    <!-- Modal de dificultad -->
    <div id="modal-partido">
      <div id="modal-contenido">
        <h2>Elige dificultad</h2>
        <select id="nivel">
          <option value="facil">Fácil (11 fallos)</option>
          <option value="medio">Medio (7 fallos)</option>
          <option value="dificil">Difícil (4 fallos)</option>
        </select>
        <br />
        <button onclick="iniciarJuego()">Empezar</button>
      </div>
    </div>

    <div class="juego">
      <div class="zona-izquierda">
        <div class="escenario">
          <div class="muneco" id="muneco">
            <img src="../assets/img/iconos/pelota.png" alt="Pelota" />
          </div>
          <div class="puerta" id="puerta">
            <img src="../assets/img/iconos/porteria.png" alt="Portería" />
          </div>
        </div>
        <div class="palabra" id="palabra"></div>
      </div>
      <div class="letras" id="letras"></div>
    </div>

    <script src="../assets/js/palabras.js"></script>
    <script>
      let palabraSecreta;
      let progreso;
      let pasos = 0;
      let maxPasos;
      const palabraEl = document.getElementById("palabra");
      const letrasEl = document.getElementById("letras");
      const muneco = document.getElementById("muneco");
      const puerta = document.getElementById("puerta");

      function iniciarJuego() {
        const nivel = document.getElementById("nivel").value;
        if (nivel === "facil") maxPasos = 11;
        if (nivel === "medio") maxPasos = 7;
        if (nivel === "dificil") maxPasos = 4;

        // Cerrar modal
        document.getElementById("modal-partido").style.display = "none";

        // Reiniciar variables
        palabraSecreta =
          palabras[Math.floor(Math.random() * palabras.length)].toUpperCase();
        progreso = Array(palabraSecreta.length).fill("_");
        pasos = 0;
        muneco.style.left = "0px";
        letrasEl.innerHTML = "";

        mostrarPalabra();
        crearBotones();
      }

      function mostrarPalabra() {
        palabraEl.textContent = progreso.join(" ");
      }

      function crearBotones() {
        const abecedario = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ".split("");
        abecedario.forEach((letra) => {
          const btn = document.createElement("button");
          btn.textContent = letra;
          btn.onclick = () => manejarLetra(btn, letra);
          letrasEl.appendChild(btn);
        });
      }

      function manejarLetra(btn, letra) {
        btn.disabled = true;
        if (palabraSecreta.includes(letra)) {
          btn.style.background = "green";
          for (let i = 0; i < palabraSecreta.length; i++) {
            if (palabraSecreta[i] === letra) {
              progreso[i] = letra;
            }
          }
          mostrarPalabra();
          if (!progreso.includes("_")) {
            setTimeout(() => alert("¡Ganaste!"), 200);
          }
        } else {
          btn.style.background = "red";
          pasos++;
          moverMuneco();
        }
      }

      // Se encarga del movimiento del balon
      function moverMuneco() {
        const escenario = document.querySelector(".escenario");
        const escenarioRect = escenario.getBoundingClientRect();
        const puertaRect = puerta.getBoundingClientRect();

        // Coordenada X del centro de la portería relativo al escenario
        const centroPuerta =
          puertaRect.left - escenarioRect.left + puertaRect.width / 2;

        // Posición final donde debe quedar la pelota en caso de perder
        const destinoFinal = centroPuerta - muneco.clientWidth / 2;

        // Distancia que avanza en cada fallo
        const paso = destinoFinal / maxPasos;

        // Mover pelota progresivamente
        muneco.style.left = pasos * paso + "px";

        // Detectar derrota
        if (pasos >= maxPasos) {
          setTimeout(
            () => alert("Perdiste. La palabra era: " + palabraSecreta),
            300
          );
        }
      }
    </script>
  </body>
</html>
